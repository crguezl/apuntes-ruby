<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>ssh-agent y Sesiones X</TITLE>
<META NAME="description" CONTENT="ssh-agent y Sesiones X">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node1007.html">
<LINK REL="previous" HREF="node1005.html">
<LINK REL="up" HREF="node1005.html">
<LINK REL="next" HREF="node1007.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html18541"
  HREF="node1007.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html18535"
  HREF="node1005.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html18529"
  HREF="node1005.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html18537"
  HREF="node1223.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html18539"
  HREF="node1226.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://nereida.deioc.ull.es/~lpp/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="LPP"></A><A NAME="tex2html30"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1102"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html31"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1091"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html32"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html33"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html34"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html35"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html36"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html37"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html39"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html41"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html18542"
  HREF="node1007.html">Arrancando el Agente en</A>
<B> Subir:</B> <A NAME="tex2html18536"
  HREF="node1005.html">Mejor un Sólo Agente</A>
<B> Anterior:</B> <A NAME="tex2html18530"
  HREF="node1005.html">Mejor un Sólo Agente</A>
 &nbsp; <B>  <A NAME="tex2html18538"
  HREF="node1223.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html18540"
  HREF="node1226.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H4><A NAME="SECTION06470010000000000000">
<TT>ssh-agent</TT> y Sesiones X</A>
</H4>
  

<P>
Es común ver que en ciertos Unix el arranque de la sesión X 
lleva aparejado el arranque de un agente SSH.
Si ese es nuestro caso, tenemos la mayor parte del trabajo hecho.
Por ejemplo en una configuración típica de Kubuntu vemos lo
siguiente:

<P>
<PRE>
$ cat -n /etc/X11/Xsession.options
 1  # $Id: Xsession.options 189 2005-06-11 00:04:27Z branden $
 2  #
 3  # configuration options for /etc/X11/Xsession
 4  # See Xsession.options(5) for an explanation of the available options.
 5  allow-failsafe
 6  allow-user-resources
 7  allow-user-xsession
 8  use-ssh-agent
 9  use-session-dbus
</PRE>

<P>
La opción <code>use-ssh-agent</code> hace que se dispare un agente en el momento
de arrancar las X. En efecto si vemos los procesos en el sistema
descubrimos la presencia de un agente:
<PRE>
casiano@europa:~$ ps -fA | grep agent
casiano   6976  6911  0 10:57 ?        00:00:00 /usr/bin/ssh-agent x-session-manager
casiano   8018  7625  0 11:07 pts/3    00:00:00 grep agent
</PRE>
Viendo las variables de entorno podemos ver el lugar en el que está el socket:
<PRE>
casiano@europa:~$ env | grep -i ssh
SSH_AGENT_PID=6976
SSH_AUTH_SOCK=/tmp/ssh-qkuycC6911/agent.6911
</PRE>
Podemos ver que el socket tiene los permisos puestos para que pueda ser accedida por el usuario
que arrancó las X:
<PRE>
casiano@europa:~$ ls -ld /tmp/ssh-qkuycC6911/
drwx------ 2 casiano casiano 4096 2009-04-27 10:57 /tmp/ssh-qkuycC6911/
casiano@europa:~$ ls -l /tmp/ssh-qkuycC6911/
total 0
srw------- 1 casiano casiano 0 2009-04-27 10:57 agent.6911
</PRE>
por tanto el usuario que arrancó las X puede acceder a ese agente.
Veamos que claves están en ese agente:
<PRE>
rw------- 1 casiano casiano 0 2009-04-27 10:57 agent.6911
casiano@europa:~$ ssh-add -l
1024 49:4c:e1:b4:1a:ea:e6:73:fc:a1:e5:6b:54:c9:da:62 /home/casiano/.ssh/id_dsa (DSA)
</PRE>
Ya esta la clave <code>/home/casiano/.ssh/id_dsa</code>. 
Probablemente lo haya hecho en alguna prueba anterior.
Para empezar esta nueva prueba desde una situación inicial
vamos a suprimir todas las claves del agente.
<PRE>
casiano@europa:~$ ssh-add -D
All identities removed.
</PRE>
Si ahora intento conectarme a una máquina con esa clave,
me es solicitada la passphrase:
<PRE>
casiano@europa:~$ ssh orion
Enter passphrase for key '/home/casiano/.ssh/id_dsa':
^C
</PRE>
Interrumpo la conexión pulsando CTRL-C y paso a añadir la 
clave al agente:
<PRE>
casiano@europa:~$ ssh-add /home/casiano/.ssh/id_dsa
Enter passphrase for /home/casiano/.ssh/id_dsa:
Identity added: /home/casiano/.ssh/id_dsa (/home/casiano/.ssh/id_dsa)
</PRE>
Ahora puedo hacer la conexión sin necesidad de introducir la passphrase:
<PRE>
casiano@europa:~$ ssh orion
Linux orion 2.6.8-2-686 #1 Tue Aug 16 13:22:48 UTC 2005 i686 GNU/Linux
</PRE>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html18541"
  HREF="node1007.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html18535"
  HREF="node1005.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html18529"
  HREF="node1005.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html18537"
  HREF="node1223.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html18539"
  HREF="node1226.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://nereida.deioc.ull.es/~lpp/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="LPP"></A><A NAME="tex2html30"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1102"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html31"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1091"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html32"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html33"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html34"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html35"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html36"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html37"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html39"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html41"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html18542"
  HREF="node1007.html">Arrancando el Agente en</A>
<B> Subir:</B> <A NAME="tex2html18536"
  HREF="node1005.html">Mejor un Sólo Agente</A>
<B> Anterior:</B> <A NAME="tex2html18530"
  HREF="node1005.html">Mejor un Sólo Agente</A>
 &nbsp; <B>  <A NAME="tex2html18538"
  HREF="node1223.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html18540"
  HREF="node1226.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-01-08
</ADDRESS>
</BODY>
</HTML>
