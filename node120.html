<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Bloques</TITLE>
<META NAME="description" CONTENT="Bloques">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node121.html">
<LINK REL="previous" HREF="node118.html">
<LINK REL="up" HREF="node115.html">
<LINK REL="next" HREF="node121.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html4991"
  HREF="node121.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html4985"
  HREF="node115.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html4979"
  HREF="node119.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html4987"
  HREF="node797.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html4989"
  HREF="node800.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html4992"
  HREF="node121.html">Alterando el Flujo de</A>
<B> Subir:</B> <A NAME="tex2html4986"
  HREF="node115.html">Sentencias y Estructuras de</A>
<B> Anterior:</B> <A NAME="tex2html4980"
  HREF="node119.html">Lazy Enumerables/Enumeradores Perezosos</A>
 &nbsp; <B>  <A NAME="tex2html4988"
  HREF="node797.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html4990"
  HREF="node800.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION02540000000000000000">
Bloques</A>
</H1>
Ruby <A NAME="5003"></A><SPAN  CLASS="textit">Code blocks</SPAN> (called <A NAME="5005"></A><SPAN  CLASS="textit">closures</SPAN> in other languages) are 
chunks of code between braces
or between <code>do..end</code> that you can associate with 
<FONT COLOR="#0000ff"> method invocations</FONT>,
almost as if they were parameters. 

<P>
A Ruby block is a way of grouping
statements, and may appear only in the source adjacent to a method call;

<P>
the block is written starting on the same line as the method call's last
parameter (or the closing parenthesis of the parameter list). 

<P>

<UL>
<LI>The code in
the block is not executed at the time it is encountered. 
</LI>
<LI>Instead, Ruby
remembers the context in which the block appears (the local variables,
the current object, and so on) and then enters the method.
</LI>
</UL>

<P>
The Ruby standard is to use braces for single-line blocks and <code>do..end</code>
for multi-line blocks. 

<P>

<H4><A NAME="SECTION02540010000000000000">
yield</A>
</H4>
  

<P>
Any method can be called with a block as an implicit
argument. Inside the method, you can call the block using the <code>yield</code>
keyword with a value.

<P>
Blocks can have their own arguments. There
are many methods in Ruby that iterate over a range of values. 
<PRE>
1] pry(main)&gt; a = (1..8).to_a
=&gt; [1, 2, 3, 4, 5, 6, 7, 8]
[2] pry(main)&gt; a.each { |x| puts x*x };
1
4
9
16
25
36
49
64
</PRE>

<P>
Most of
these iterators are written in such a way as to be able to take a code
block as part of their calling syntax. 

<P>
The method can then <code>yield</code> control
to the code block (i.e. execute the block) during execution as many times
as is necessary for the iteration to complete (e.g. if we are iterating
over array values, we can execute the block as many times as there are
array values etc.).

<P>
Once you have created a block, you can associate it with a call to a
method. Usually 
<FONT COLOR="#0000ff"> the code blocks passed into methods are anonymous objects</FONT>,
created on the spot.

<P>
If you provide a code block when you call a method, then inside the
method, you can <code>yield</code> control to that code block - suspend execution
of the method; execute the code in the block; and return control to the
method body, right after the call to <code>yield</code>. 

<P>
<PRE>
[~/local/src/ruby/rubytesting]$ cat block_simple.rb 
def call_block
  puts "Start of method" 
  yield
  yield
  puts "End of method"
end
</PRE>

<P>
<PRE>
[3] pry(main)&gt; require_relative 'block_simple'
=&gt; true
[4] pry(main)&gt; call_block do puts "hello!" end 
Start of method
hello!
hello!
End of method
=&gt; nil
</PRE>

<P>
If no code block is passed,
Ruby raises an exception
<PRE>
~/rubytesting]$ pry
[1] pry(main)&gt; require_relative 'block_simple'
=&gt; true
[2] pry(main)&gt; call_block
Start of method
LocalJumpError: no block given (yield)
from /Users/casiano/local/src/ruby/rubytesting/block_simple.rb:3:in `call_block'
</PRE>

<P>
You can provide parameters to the call to <code>yield</code>: these will be passed
to the block. Within the block, you list the names of the arguments to
receive the parameters between vertical bars (<code>|</code>).
<PRE>
[~/local/src/ruby/rubytesting]$ pry
[1] pry(main)&gt; def tutu(x)
[1] pry(main)*   "hello #{ yield x }"
[1] pry(main)* end  
=&gt; nil
[2] pry(main)&gt; tutu('Juan') { |y| y+'a' }
=&gt; "hello Juana"
[3] pry(main)&gt;
</PRE>

<P>

<FONT COLOR="#0000ff"> Note that the code in the block is not executed at the time it is
encountered by the Ruby interpreter.</FONT> 
<FONT COLOR="#ff0000"> Instead, Ruby remembers the context
in which the block appears and then enters the method.</FONT>

<P>
<PRE>
[~/rubytesting]$ cat block_simple2.rb 
y = 4

def call_block(a)
  puts "Start of method" 
  puts "Inside the method a = #{a}"
  yield 4
  yield 5
  puts "End of method"
end

call_block 8 do |x|
    puts x+y
end
[~/rubytesting]$ ruby block_simple2.rb 
Start of method
Inside the method a = 8
8
9
End of method
</PRE>

<P>

<H4><A NAME="SECTION02540020000000000000">
block_given?</A>
</H4>
  

<P>
<code>block_given?</code> returns <code>true</code> if 
<code>yield</code> would execute a block in the current context. 

<P>
<PRE>
[5] pry(main)&gt; show-source tutu

From: (pry) @ line 3:
Owner: Object
Visibility: public
Number of lines: 4

def tutu
  return yield 4 if block_given?
  "no block was given!"
end
[6] pry(main)&gt; tutu { |x| x*x }
=&gt; 16
[7] pry(main)&gt; tutu 
=&gt; "no block was given!"
</PRE>

<P>

<H4><A NAME="SECTION02540030000000000000">
Ambito/Scope</A>
</H4>
  

<P>
Let us see what happens in the following example when a variable outside a block is x and a block parameter is also named x.

<P>
<PRE>
[~/rubytesting]$ cat block_scope1.rb 
x = 10  
5.times do |x|  
  puts "x inside the block: #{x}"  
end  
  
puts "x outside the block: #{x}"  
[~/rubytesting]$ ruby block_scope1.rb 
x inside the block: 0
x inside the block: 1
x inside the block: 2
x inside the block: 3
x inside the block: 4
x outside the block: 10
</PRE>
You will observe that after the block has executed, x outside the block is the original x. Hence the block parameter x was local to the block.

<P>
Since x is not a block parameter here, the variable x is the same inside and outside the block.
<PRE>
[~/rubytesting]$ cat block_scope2.rb 
x = 10  
5.times do |y|  
  x = y  
  puts "x inside the block: #{x}"  
end  
  
puts "x outside the block: #{x}"  
[~/rubytesting]$ ruby block_scope2.rb 
x inside the block: 0
x inside the block: 1
x inside the block: 2
x inside the block: 3
x inside the block: 4
x outside the block: 4
</PRE>

<P>
In Ruby 1.9, blocks introduce their own scope for the block parameters only. This is illustrated by the following example:

<P>
<PRE>
[~/rubytesting]$ cat block_scope3.rb  
x = 10  
5.times do |y, x|  
  x = y  
  puts "x inside the block: #{x}"  
end  
puts "x outside the block: #{x}"  
[~/rubytesting]$ ruby -v
ruby 2.1.2p95 (2014-05-08 revision 45877) [x86_64-darwin13.0]
[~/rubytesting]$ ruby block_scope3.rb 
x inside the block: 0
x inside the block: 1
x inside the block: 2
x inside the block: 3
x inside the block: 4
x outside the block: 10
[~/rubytesting]$ rvm use 1.8.7-p352
Using /Users/casiano/.rvm/gems/ruby-1.8.7-p352
[~/rubytesting]$ ruby -v
ruby 1.8.7 (2011-06-30 patchlevel 352) [i686-darwin11.3.0]
[~/rubytesting]$ ruby block_scope3.rb 
x inside the block: 0
x inside the block: 1
x inside the block: 2
x inside the block: 3
x inside the block: 4
x outside the block: 4
</PRE>

<P>

<H4><A NAME="SECTION02540040000000000000">
Ambiguedad</A>
</H4>
  

<P>
Keep in mind that the braces syntax has a higher
precedence than the <code>do..end</code> syntax. 

<P>
Braces have a high precedence; <code>do</code>
has a low precedence. If the method invocation has parameters that are
not enclosed in parentheses, the brace form of a block will bind to the
last parameter, not to the overall invocation. 
<PRE>
7] pry(main)&gt; a = [1,2,3]
=&gt; [1, 2, 3]
[8] pry(main)&gt; p a.map { |n| n*2 }
[2, 4, 6]
=&gt; [2, 4, 6]
[9] pry(main)&gt; p a.map do |n| n*2 end
#&lt;Enumerator: [1, 2, 3]:map&gt;
</PRE>

<P>
The <code>do</code> form will bind to
the invocation.

<P>

<H4><A NAME="SECTION02540050000000000000">
Véase</A>
</H4>
  

<UL>
<LI><A NAME="tex2html223"
  HREF="http://rubylearning.com/satishtalim/ruby_blocks.html">Ruby Blocks</A>
en rubylearning.com por Satish Talim
</LI>
<LI>La sección <I>Argumentos Bloque</I> en 
<A HREF="node143.html#subsection:argumentosdebloque">13.4.6</A>
dentro de la sección
<I>Argumentos de un Método</I> <A HREF="node137.html#section:argumentosdeunmetodo">13.4</A>
</LI>
<LI>La sección <I>Bindings (encarpetados) y eval</I> <A HREF="node241.html#subsection:bindings">15.2.1</A>
</LI>
</UL>

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html4993"
  HREF="node120.html#SECTION02540010000000000000">yield</A>
<LI><A NAME="tex2html4994"
  HREF="node120.html#SECTION02540020000000000000">block_given?</A>
<LI><A NAME="tex2html4995"
  HREF="node120.html#SECTION02540030000000000000">Ambito/Scope</A>
<LI><A NAME="tex2html4996"
  HREF="node120.html#SECTION02540040000000000000">Ambiguedad</A>
<LI><A NAME="tex2html4997"
  HREF="node120.html#SECTION02540050000000000000">Véase</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html4991"
  HREF="node121.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html4985"
  HREF="node115.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html4979"
  HREF="node119.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html4987"
  HREF="node797.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html4989"
  HREF="node800.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html4992"
  HREF="node121.html">Alterando el Flujo de</A>
<B> Subir:</B> <A NAME="tex2html4986"
  HREF="node115.html">Sentencias y Estructuras de</A>
<B> Anterior:</B> <A NAME="tex2html4980"
  HREF="node119.html">Lazy Enumerables/Enumeradores Perezosos</A>
 &nbsp; <B>  <A NAME="tex2html4988"
  HREF="node797.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html4990"
  HREF="node800.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-10-21
</ADDRESS>
</BODY>
</HTML>
