<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Gestión de Sesiones</TITLE>
<META NAME="description" CONTENT="Gestión de Sesiones">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node378.html">
<LINK REL="previous" HREF="node375.html">
<LINK REL="up" HREF="node356.html">
<LINK REL="next" HREF="node377.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html9668"
  HREF="node377.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html9662"
  HREF="node356.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html9656"
  HREF="node375.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html9664"
  HREF="node807.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html9666"
  HREF="node810.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html9669"
  HREF="node377.html">Ejercicio: Race Conditions. Concurrencia</A>
<B> Subir:</B> <A NAME="tex2html9663"
  HREF="node356.html">Rack, un Webserver Ruby</A>
<B> Anterior:</B> <A NAME="tex2html9657"
  HREF="node375.html">Cookies y Rack</A>
 &nbsp; <B>  <A NAME="tex2html9665"
  HREF="node807.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html9667"
  HREF="node810.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION03190000000000000000"></A>
<A NAME="section:gestiondesesiones"></A>
<BR>
Gestión de Sesiones
</H1>

<P>

<H4><A NAME="SECTION03190010000000000000">
Introducción</A>
</H4>
  

<P>

<OL>
<LI>Hypertext Transfer Protocol (HTTP) is stateless: a client computer
running a web browser must establish a new Transmission Control
Protocol (TCP) network connection to the web server with each new
HTTP GET or POST request. 

<P>
</LI>
<LI>The web server, therefore, cannot rely
on an established TCP network connection for longer than a single
HTTP GET or POST operation. 

<P>
</LI>
<LI><A NAME="16526"></A><SPAN  CLASS="textbf">Session management</SPAN> is the technique
used by the web developer to make the stateless HTTP protocol support
session state. 

<P>
</LI>
<LI>For example, once a user has been authenticated to
the web server, the user's next HTTP request (GET or POST) should
not cause the web server to ask for the user's account and password
again. 

<P>
</LI>
<LI>The session information is stored on the web server using the 
<A NAME="16528"></A><SPAN  CLASS="textbf">session identifier</SPAN>
generated as a result of the first (sometimes
the first authenticated) request from the end user running a web
browser. 

<P>
</LI>
<LI>The "storage" of Session IDs and the associated session
data (user name, account number, etc.) on the web server is
accomplished using a variety of techniques including, but not limited
to, local memory, flat files, and databases.

<P>
</LI>
<LI>A <A NAME="16530"></A><SPAN  CLASS="textbf">session token</SPAN> 
<FONT COLOR="#0000ff"> is a unique identifier that is generated and sent
from a server to a client to identify the current interaction
session</FONT>. 

<P>
</LI>
<LI>The client usually stores and sends the token as an HTTP
cookie and/or sends it as a parameter in GET or POST queries. The
reason to use session tokens is that the client only has to handle
the identifier—all session data is stored on the server (usually
in a database, to which the client does not have direct access)
linked to that identifier. 
</LI>
</OL>

<P>

<H4><A NAME="SECTION03190020000000000000">
Uso de Cookies para el manejo de sesiones</A>
</H4>
  

<P>

<OL>
<LI>Allowing users to log into a website is a frequent use of
    cookies. 
</LI>
<LI>A web server typically sends a cookie containing a unique 
    <A NAME="16538"></A><SPAN  CLASS="textbf">session identifier</SPAN>. 
</LI>
<LI>The web browser will send back that session identifier
   with each subsequent request and 
<FONT COLOR="#0000ff"> related items are stored
   associated with this unique session identifier</FONT>.
</LI>
<LI>Typically the web server will first send a cookie
    containing a unique session identifier. Users then submit their
    credentials and the web application authenticates the session
    and allows the user access to services.
</LI>
<LI>Applications today usually store the gathered information
    in a database on the server side, rather than storing them 
    in cookies
  
</LI>
</OL>

<P>

<H4><A NAME="SECTION03190030000000000000">
Ejemplo</A>
</H4>
  

<P>
<A NAME="tex2html868"
  HREF="http://rack.rubyforge.org/doc/Rack/Session/Cookie.html">Rack::Session::Cookie</A> proporciona un sencillo sistema para gestionar
sesiones basado en cookies.

<P>

<OL>
<LI>La <code>session</code> es un cookie que contiene un
hash almacenado mediante marshalling codificado en base64.
</LI>
<LI>Por defecto el nombre del cookie es <code>rack.session</code> pero puede ser 
modificado mediante el atributo <code>:key</code>.
</LI>
<LI>Dándole un valor a <code>secret_key</code> se garantiza que es comprobada 
la integridad de los datos de la cookie
</LI>
<LI>Para acceder dentro de nuestro programa
a la sesión accedemos al hash <code>env["rack.session"]</code> o bien
<code>env["key-value"]</code> si hemos especificado el atributo
<code>:key</code>
</LI>
</OL>

<P>
Sigue un ejemplo:
<PRE>
[~/local/src/ruby/sinatra/rack/rack-session-cookie(master)]$ cat configapp.ru 
require 'pp'
require './myapp'

use Rack::Session::Cookie, 
      :key =&gt; 'rack.session', 
      :domain =&gt; 'example.com',
      :secret =&gt; 'some_secret'

run MyApp.new
</PRE>

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-session-cookie(master)]$ cat myapp.rb 
class MyApp

  def set_env(env)
    @env = env
    @session = env['rack.session']
  end

  def some_key 
    return @session['some_key'].to_i if @session['some_key']
    @session['some_key'] = 0
  end

  def some_key=(value)
    @session['some_key'] = value
  end

  def call(env)
    set_env(env)
    res = Rack::Response.new
    req = Rack::Request.new env

    self.some_key = self.some_key + 1 if req.path == '/'

    res.write("some_key = #{@session['some_key']}\n")

    res.finish
  end

end
</PRE>

<P>
Hagamos la prueba conectándonos a <code>www.example.com</code>. Para ello
edtiamos <code>/etc/hosts</code> para que <code>localhost</code> apunte a
<code>www.example.com</code>:

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-session-cookie(master)]$ cat /etc/hosts
##
# Host Database
#
# localhost is used to configure the loopback interface
# when the system is booting.  Do not change this entry.
##
127.0.0.1 localhost www.example.com
...
</PRE>

<P>
Arrancamos el servidor:

<P>
<PRE>
[~/local/src/ruby/sinatra/rack/rack-session-cookie(master)]$ rackup  configapp.ru 
&gt;&gt; Thin web server (v1.5.1 codename Straight Razor)
&gt;&gt; Maximum connections set to 1024
&gt;&gt; Listening on 0.0.0.0:9292, CTRL+C to stop
</PRE>

<P>
Y visitamos <code>www.example.com</code> con nuestro navegador:

<img src="rack_session_example.png" />

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html9670"
  HREF="node376.html#SECTION03190010000000000000">Introducción</A>
<LI><A NAME="tex2html9671"
  HREF="node376.html#SECTION03190020000000000000">Uso de Cookies para el manejo de sesiones</A>
<LI><A NAME="tex2html9672"
  HREF="node376.html#SECTION03190030000000000000">Ejemplo</A>
</UL>
</UL>
<BR>
<LI><A NAME="tex2html9673"
  HREF="node377.html">Ejercicio: Race Conditions. Concurrencia</A>
</UL>
<!--End of Table of Child-Links-->

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html9668"
  HREF="node377.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html9662"
  HREF="node356.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html9656"
  HREF="node375.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html9664"
  HREF="node807.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html9666"
  HREF="node810.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html9669"
  HREF="node377.html">Ejercicio: Race Conditions. Concurrencia</A>
<B> Subir:</B> <A NAME="tex2html9663"
  HREF="node356.html">Rack, un Webserver Ruby</A>
<B> Anterior:</B> <A NAME="tex2html9657"
  HREF="node375.html">Cookies y Rack</A>
 &nbsp; <B>  <A NAME="tex2html9665"
  HREF="node807.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html9667"
  HREF="node810.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-11-17
</ADDRESS>
</BODY>
</HTML>
