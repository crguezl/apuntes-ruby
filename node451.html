<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Uploads. Subida de Ficheros en Sinatra</TITLE>
<META NAME="description" CONTENT="Uploads. Subida de Ficheros en Sinatra">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node452.html">
<LINK REL="previous" HREF="node450.html">
<LINK REL="up" HREF="node431.html">
<LINK REL="next" HREF="node452.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html11127"
  HREF="node452.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html11121"
  HREF="node431.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html11115"
  HREF="node450.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html11123"
  HREF="node849.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html11125"
  HREF="node852.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html11128"
  HREF="node452.html">halt</A>
<B> Subir:</B> <A NAME="tex2html11122"
  HREF="node431.html">Fundamentos</A>
<B> Anterior:</B> <A NAME="tex2html11116"
  HREF="node450.html">Downloads / Descargas /</A>
 &nbsp; <B>  <A NAME="tex2html11124"
  HREF="node849.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html11126"
  HREF="node852.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION033120000000000000000">
Uploads. Subida de Ficheros en Sinatra</A>
</H1>

<P>

<H4><A NAME="SECTION033120010000000000000">
Véase</A>
</H4>
  

<OL>
<LI><A NAME="tex2html1062"
  HREF="https://github.com/crguezl/sinatra-upload">El repositorio sinatra-upload en GitHub</A>
con el código de este ejemplo
</LI>
<LI><A NAME="tex2html1063"
  HREF="http://www.wooptoot.com/file-upload-with-sinatra">FILE UPLOAD WITH SINATRA</A>
BY PANDAFOX POSTED IN RUBY, TUTORIALS
</LI>
<LI><A NAME="tex2html1064"
  HREF="http://stackoverflow.com/questions/18860656/multiple-file-uploads-in-sinatra">Multiple file uploads in Sinatra</A>
</LI>
</OL>

<P>

<H4><A NAME="SECTION033120020000000000000">
Jerarquía de ficheros</A>
</H4>
  

<PRE>
[~/sinatra/sinatra-upload]$ tree
.
|-- app.rb
|-- uploads
|   `--- README
`--- views
    `--- upload.haml

2 directories, 3 files
</PRE>

<P>

<H4><A NAME="SECTION033120030000000000000">
upload.haml</A>
</H4>
  

<P>
The important part is not to forget to set the <code>enctype</code> 
in your form element, otherwise you will just get the filename instead of an object:

<P>
<PRE>
[~/sinatra/sinatra-upload(master)]$ cat views/upload.haml 
%html
  %body
    %h1 File uploader!
    %form(method="post" enctype='multipart/form-data')   
      %input(type='file' name='myfile')    
      %br
      %input(type='submit' value='Upload!')
</PRE>

<P>

<H4><A NAME="SECTION033120040000000000000">
app.rb</A>
</H4>
  

<PRE>
[~/sinatra/sinatra-upload(master)]$ cat app.rb 
require 'rubygems'
require 'sinatra'
require 'haml'
require 'pp'
 
# Handle GET-request (Show the upload form)
get "/upload?" do
  haml :upload
end      
    
# Handle POST-request (Receive and save the uploaded file)
post "/upload" do 
  pp params
  File.open('uploads/' + params['myfile'][:filename], "w") do |f|
    f.write(params['myfile'][:tempfile].read)
  end
  return "The file was successfully uploaded!"
end
[~/sinatra/sinatra-upload(master)]$
</PRE>

<P>
As you can see, you don’t have to write much code to get this to
work. The <code>params</code>-hash contains our uploaded element with data such
as filename, type and the actual datafile, which can be accessed
as a Tempfile-object. 

<P>
We read the contents from this file and store
it into a directory called uploads, which you will have to create
before running this script.

<P>
Here’s an example of what the <code>params</code>-hash may look like when uploading
a picture of a cat:

<P>
<PRE>
{
  "myfile" =&gt; {
    :type =&gt; "image/png",
    :head =&gt;  "Content-Disposition: form-data;
               name=\"myfile\";
               filename=\"cat.png\"\r\n
               Content-Type: image/png\r\n",
    :name =&gt; "myfile",
    :tempfile =&gt; #&lt;File:/var/folders/3n/3asd/-Tmp-/RackMultipart201-1476-nfw2-0&gt;,
    :filename=&gt;"cat.png"
  }
}
</PRE>

<P>
<A NAME="tex2html1065"
  HREF="http://youtu.be/7tkQUTUxJWE">File upload with sinatra. YouTube</A>
<P>

<H4><A NAME="SECTION033120050000000000000">
BEWARE!</A>
</H4>
  

<P>
This script offers little to no security at all. Clients will be able to overwrite old images, fill up your harddrive and so on. So just use some common sense and do some Ruby magic to patch up the security holes yourself.

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html11129"
  HREF="node451.html#SECTION033120010000000000000">Véase</A>
<LI><A NAME="tex2html11130"
  HREF="node451.html#SECTION033120020000000000000">Jerarquía de ficheros</A>
<LI><A NAME="tex2html11131"
  HREF="node451.html#SECTION033120030000000000000">upload.haml</A>
<LI><A NAME="tex2html11132"
  HREF="node451.html#SECTION033120040000000000000">app.rb</A>
<LI><A NAME="tex2html11133"
  HREF="node451.html#SECTION033120050000000000000">BEWARE!</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html11127"
  HREF="node452.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html11121"
  HREF="node431.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html11115"
  HREF="node450.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html11123"
  HREF="node849.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html11125"
  HREF="node852.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html11128"
  HREF="node452.html">halt</A>
<B> Subir:</B> <A NAME="tex2html11122"
  HREF="node431.html">Fundamentos</A>
<B> Anterior:</B> <A NAME="tex2html11116"
  HREF="node450.html">Downloads / Descargas /</A>
 &nbsp; <B>  <A NAME="tex2html11124"
  HREF="node849.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html11126"
  HREF="node852.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-12-01
</ADDRESS>
</BODY>
</HTML>
