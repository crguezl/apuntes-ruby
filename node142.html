
<H2><A NAME="SECTION02661000000000000000">
Clausuras y Variables Compartidas</A>
</H2>

<P>

<OL>
<LI>El término <A NAME="5480"><tex2html_anchor_invisible_mark></A><SPAN  CLASS="textit">clausura</SPAN> se refiere a un objeto que es a la vez invocable
como una función  y que dispone de un binding o entorno de ejecución para esa función.

<P>
</LI>
<LI>El objeto <A NAME="tex2html253"
  HREF="http://ruby-doc.org/core-2.0.0/Proc.html"><TT>Proc</TT></A><#4860#><#4860#> resultante de la creación de un proc o una lambda 
no sólo nos proporciona un bloque ejecutable: también nos proporciona
bindings para todas las variables que son usadas por el bloque
</LI>
<LI>El bloque asociado con la invocación de <tex2html_verb_mark>404<tex2html_verb_mark>
usa <tex2html_verb_mark>405<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim563#</PRE>
</LI>
<LI>Si en vez de un proc usamos una lambda, el acceso a <tex2html_verb_mark>406<tex2html_verb_mark> 
permanece mas allá de <tex2html_verb_mark>407<tex2html_verb_mark>. Es esta característica la
que hace que la lambda <tex2html_verb_mark>408<tex2html_verb_mark> sea una clausura:
<PRE><tex2html_verbatim_mark>verbatim564#</PRE>
<tex2html_verb_mark>409<tex2html_verb_mark> encapsula o clausura con la lambda el binding 
de <tex2html_verb_mark>410<tex2html_verb_mark>
</LI>
<LI>Return a pair of lambdas that share access to a local variable.
<PRE><tex2html_verbatim_mark>verbatim565#</PRE>
</LI>
<LI>Este código retorna un array de lambdas que son multiplicadores:
<PRE><tex2html_verbatim_mark>verbatim566#</PRE>

<P>
<PRE><tex2html_verbatim_mark>verbatim567#</PRE>
Veamos que ocurre cuando descomentamos la línea <tex2html_verb_mark>411<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim568#</PRE>
En Ruby 1.8 la <tex2html_verb_mark>412<tex2html_verb_mark> del argumento del bloque no es local al bloque sino que 
es la <tex2html_verb_mark>413<tex2html_verb_mark> de <tex2html_verb_mark>414<tex2html_verb_mark> definida en <tex2html_verb_mark>415<tex2html_verb_mark>.
Obsérvese que la llamada <tex2html_verb_mark>416<tex2html_verb_mark> retorna un array con dos 
lambdas.
Obtenemos así un comportamiento inesperado:
<PRE><tex2html_verbatim_mark>verbatim569#</PRE>
Esto es así porque la única <tex2html_verb_mark>417<tex2html_verb_mark> contiene el último valor asignado a ella: 3.

<P>
En este código el problema desaparece con versiones posteriores a la 1.9 porque los
argumentos de un bloque son siempre locales:
<PRE><tex2html_verbatim_mark>verbatim570#</PRE>
</LI>
</OL>

<P>
