<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>DCell</TITLE>
<META NAME="description" CONTENT="DCell">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="previous" HREF="node291.html">
<LINK REL="up" HREF="node291.html">
<LINK REL="next" HREF="node293.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html7700"
  HREF="node293.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html7694"
  HREF="node291.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html7690"
  HREF="node291.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html7696"
  HREF="node769.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html7698"
  HREF="node772.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://nereida.deioc.ull.es/~lpp/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="LPP"></A><A NAME="tex2html30"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html31"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html32"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html33"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html34"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html35"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html36"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html37"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html39"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html41"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html7701"
  HREF="node293.html">El Problema de los</A>
<B> Subir:</B> <A NAME="tex2html7695"
  HREF="node291.html">Celluloid</A>
<B> Anterior:</B> <A NAME="tex2html7691"
  HREF="node291.html">Celluloid</A>
 &nbsp; <B>  <A NAME="tex2html7697"
  HREF="node769.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html7699"
  HREF="node772.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION021211000000000000000">
DCell</A>
</H2>

<P>
<BLOCKQUOTE>
Objects can message objects transparently that live on other machines over the network, and you don't have to worry about the networking gunk, and you don't have to worry about finding them, and you don't have to worry about anything. It's just as if you messaged an object that's right next door.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>
<DIV ALIGN="RIGHT">Steve Jobs. 1995

</BLOCKQUOTE>
DCell is a simple and easy way to build distributed applications
in Ruby. Somewhat similar to DRb, DCell lets you easily expose Ruby
objects as network services, and call them remotely just like you
would any other Ruby object. However, unlike DRb all objects in the
system are concurrent. You can create and register several available
services on a given node, obtain handles to them, and easily pass
these handles around the network just like any other objects.

<P>
DCell is a distributed extension to Celluloid, which provides
concurrent objects for Ruby with many of the features of Erlang,
such as the ability to supervise objects and restart them when they
crash, and also link to other objects and receive event notifications
of when they crash. This makes it easier to build robust, fault-tolerant
distributed systems.

<P>
DCell uses the 0MQ messaging protocol which provides a robust,
fault-tolerant brokerless transport for asynchronous messages sent
between nodes. DCell is built on top of the Celluloid::ZMQ library,
which provides a Celluloid-oriented wrapper around the underlying
ffi-rzmq library.

<P>
<PRE>
[~/ruby/celluloid]$ cat itchy.rb 
#!/usr/bin/env ruby
require 'dcell'

DCell.start :id =&gt; "itchy", :addr =&gt; "tcp://127.0.0.1:9001"

class Itchy
  include Celluloid

  def initialize
    puts "Ready for mayhem!"
    @n = 0
  end

  def fight
    @n = (@n % 6) + 1
    if @n &lt;= 3
      puts "Bite!"
    else
      puts "Fight!"
    end
  end
end

Itchy.supervise_as :itchy
sleep
</PRE>
To configure an individual DCell node, we need to give it a node
ID and a 0MQ address to bind to. Node IDs look like domain names,
and 0MQ addresses look like URLs that start with tcp:

<P>
<PRE>
DCell.start :id =&gt; "itchy", :addr =&gt; "tcp://127.0.0.1:9001"
</PRE>

<P>
<PRE>
[~/ruby/celluloid]$ cat scratchy.rb 
#!/usr/bin/env ruby
require 'dcell'

DCell.start :id =&gt; "scratchy", :addr =&gt; "tcp://127.0.0.1:9002"
itchy_node = DCell::Node["itchy"]

puts "Fighting itchy! (check itchy's output)"

6.times do
  itchy_node[:itchy].fight
  sleep 1
end
</PRE>
To create a cluster, we need to start another Ruby VM and connect
it to the first VM. 

<P>
<PRE>
DCell.start :id =&gt; "scratchy", :addr =&gt; "tcp://127.0.0.1:9002"
itchy_node = DCell::Node["itchy"]
</PRE>

<P>
Once you have a cluster of multiple nodes, you
can bootstrap additional nodes into the cluster by pointing them
at any node, and all nodes will gossip about the newly added node.

<P>
<PRE>
[~/sinatra/sinatra-streaming/chat_with_streaming(master)]$ redis-server 
[17773] 24 Nov 22:59:48.546 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
[17773] 24 Nov 22:59:48.549 * Max number of open files set to 10032
                _._                                                  
           _.-``__ ''-._                                             
      _.-``    `.  `_.  ''-._           Redis 2.6.14 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ ''-._                                   
 (    '      ,       .-`  | `,    )     Running in stand alone mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379
 |    `-._   `._    /     _.-'    |     PID: 17773
  `-._    `-._  `-./  _.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |           http://redis.io        
  `-._    `-._`-.__.-'_.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |                                  
  `-._    `-._`-.__.-'_.-'    _.-'                                   
      `-._    `-.__.-'    _.-'                                       
          `-._        _.-'                                           
              `-.__.-'                                               

[17773] 24 Nov 22:59:48.557 # Server started, Redis version 2.6.14
[17773] 24 Nov 22:59:48.558 * The server is now ready to accept connections on port 6379
</PRE>

<P>
<PRE>
[~/ruby/celluloid]$ ruby itchy.rb 
Ready for mayhem!
I, [2013-11-24T23:02:37.512066 #17781]  INFO -- : Connected to scratchy
Bite!
Bite!
Bite!
Fight!
Fight!
Fight!
W, [2013-11-24T23:02:52.511423 #17781]  WARN -- : Communication with scratchy interrupted
</PRE>

<P>
<PRE>
[~/ruby/celluloid]$ ruby scratchy.rb 
Fighting itchy! (check itchy's output)
I, [2013-11-24T23:02:37.506941 #17813]  INFO -- : Connected to itchy
D, [2013-11-24T23:02:43.580602 #17813] DEBUG -- : Terminating 10 actors...
W, [2013-11-24T23:02:43.584986 #17813]  WARN -- : Terminating task: type=:call, meta={:method_name=&gt;:run}, status=:zmqwait
[~/ruby/celluloid]$
</PRE>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html7700"
  HREF="node293.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html7694"
  HREF="node291.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html7690"
  HREF="node291.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html7696"
  HREF="node769.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html7698"
  HREF="node772.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://nereida.deioc.ull.es/~lpp/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="LPP"></A><A NAME="tex2html30"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html31"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html32"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html33"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html34"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html35"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html36"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html37"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html39"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html41"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html7701"
  HREF="node293.html">El Problema de los</A>
<B> Subir:</B> <A NAME="tex2html7695"
  HREF="node291.html">Celluloid</A>
<B> Anterior:</B> <A NAME="tex2html7691"
  HREF="node291.html">Celluloid</A>
 &nbsp; <B>  <A NAME="tex2html7697"
  HREF="node769.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html7699"
  HREF="node772.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez Le√≥n
2014-09-11
</ADDRESS>
</BODY>
</HTML>
