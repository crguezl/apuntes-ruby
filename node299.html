
<H1><A NAME="SECTION021340000000000000000">
Un Servidor Multithreaded (and a Client)</A>
</H1>

<P>
An almost canonical use case for threads is for writing servers
that can communicate with more than one client at a time.

<P>
<PRE><tex2html_verbatim_mark>verbatim1233#</PRE>

<P>

<OL>
<LI>To write Internet servers, we use the <A NAME="tex2html627"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPServer.html"><TT>TCPServer</TT></A><#11729#><#11729#> class
</LI>
<LI>In essence,
a <A NAME="tex2html628"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPServer.html"><TT>TCPServer</TT></A><#11730#><#11730#> object is a factory for <A NAME="tex2html629"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPSocket.html"><TT>TCPSocket</TT></A><#11731#><#11731#> objects
</LI>
<LI>Call <A NAME="tex2html630"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPServer.html"><TT>TCPServer</TT></A><#11732#><#11732#><tex2html_verb_mark>1314<tex2html_verb_mark> to specify a port for your service and
create a <A NAME="tex2html631"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPServer.html"><TT>TCPServer</TT></A><#11733#><#11733#> object
</LI>
<LI>Next, call the <tex2html_verb_mark>1315<tex2html_verb_mark> method of the returned <A NAME="tex2html632"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPServer.html"><TT>TCPServer</TT></A><#11734#><#11734#> object
</LI>
<LI>This method waits until a
client connects to the port you specified, and then returns a
<A NAME="tex2html633"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPSocket.html"><TT>TCPSocket</TT></A><#11735#><#11735#> object that represents the connection to that client
</LI>
<LI>The call
<tex2html_verb_mark>1316<tex2html_verb_mark>
is basically the same as a call to <tex2html_verb_mark>1317<tex2html_verb_mark>.
</LI>
<LI>Inside the thread we call the <tex2html_verb_mark>1318<tex2html_verb_mark> method, passing the socket
as argument 
</LI>
<LI>The block that follows the invokation of
<tex2html_verb_mark>1319<tex2html_verb_mark> specifies the behavior 
of the server. 
</LI>
<LI>Un <A NAME="tex2html634"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPSocket.html"><TT>TCPSocket</TT></A><#11736#><#11736#> es un objeto <A NAME="tex2html635"
  HREF="http://ruby-doc.org/core-2.0.0/IO.html"><TT>IO</TT></A><#11737#><#11737#>:
<PRE><tex2html_verbatim_mark>verbatim1234#</PRE>
</LI>
</OL>

<P>

<H4><A NAME="SECTION021340010000000000000">
El Cliente</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
To obtain a <A NAME="tex2html636"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPSocket.html"><TT>TCPSocket</TT></A><#11742#><#11742#> instance use the <A NAME="tex2html637"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPSocket.html"><TT>TCPSocket</TT></A><#11743#><#11743#><tex2html_verb_mark>1320<tex2html_verb_mark> class method, or with its synonym <A NAME="tex2html638"
  HREF="http://ruby-doc.org/stdlib-2.1.0/libdoc/socket/rdoc/TCPSocket.html"><TT>TCPSocket</TT></A><#11744#><#11744#><tex2html_verb_mark>1321<tex2html_verb_mark>. 

<P>
Pass the name of the host to connect to as the first argument and the port as the second argument. 

<P>
The port should be an integer between 1 and 65535, specified as a <A NAME="tex2html639"
  HREF="http://ruby-doc.org/core-2.0.0/Fixnum.html"><TT>Fixnum</TT></A><#11745#><#11745#> or <A NAME="tex2html640"
  HREF="http://ruby-doc.org/core-2.0.0/String.html"><TT>String</TT></A><#11746#><#11746#> object. 

<P>
Different internet protocols use different ports. 

<P>
Web servers use port 80 by default, for example. 

<P>
You may also pass the name of an Internet service, such as <tex2html_verb_mark>1322<tex2html_verb_mark>, as a string, in place of a port number, but this is not well documented and may be system dependent.

<P>
<PRE><tex2html_verbatim_mark>verbatim1235#</PRE>

<P>

<H4><A NAME="SECTION021340020000000000000">
ejecución del Servidor</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>


<P>
<PRE><tex2html_verbatim_mark>verbatim1236#</PRE>

<P>

<H4><A NAME="SECTION021340030000000000000">
Ejecución del Cliente</A>
</H4>
  <TABLE CELLPADDING=3>
</TABLE>

<PRE><tex2html_verbatim_mark>verbatim1237#</PRE>

<P>
