
<H2><A NAME="SECTION02881000000000000000">
Creando una <I>Palabra Clave</I></A>
</H2>

<P>
Supongamos que estamos escribiendo 
un programa <tex2html_verb_mark>1058<tex2html_verb_mark> que conecta con un servidor remoto
y que tenemos un objeto que representa dicha conexión:

<P>
<PRE><tex2html_verbatim_mark>verbatim1076#</PRE>

<P>
Este código libera los recursos asociados a la conexión después de usarla.
Sin embargo, no considera la presencia de excepciones.
Si <tex2html_verb_mark>1059<tex2html_verb_mark> lanza una excepción, <tex2html_verb_mark>1060<tex2html_verb_mark> no
se ejecutará.
<tex2html_verb_mark>1061<tex2html_verb_mark> proporciona una palabra clave  <tex2html_verb_mark>1062<tex2html_verb_mark> 
que simplifica el manejo de la liberación de recursos:

<P>
<PRE><tex2html_verbatim_mark>verbatim1077#</PRE>
La palabra <tex2html_verb_mark>1063<tex2html_verb_mark> espera que el objeto  <tex2html_verb_mark>1064<tex2html_verb_mark> tenga un método con nombre <tex2html_verb_mark>1065<tex2html_verb_mark>. 
Este método es llamado automáticamente después del código entre llaves, 
tanto si se genera una excepción como si no.

<P>
Supongamos que se nos pide como ejercicio que extendamos Ruby con una <#9169#><I>palabra clave</I><#9169#> <tex2html_verb_mark>1066<tex2html_verb_mark>
que funcione de manera similar al <tex2html_verb_mark>1067<tex2html_verb_mark> de <tex2html_verb_mark>1068<tex2html_verb_mark>.

<P>
Para comprobar que lo hagamos correctamente se nos da el siguiente
programa de test (véase <A NAME="tex2html517"
  HREF="http://en.wikipedia.org/wiki/Unit_testing">Unit Testing</A>
en la wikipedia 
y la documentación de la librería 
<A NAME="tex2html518"
  HREF="http://ruby-doc.org/stdlib-1.9.3/libdoc/test/unit/rdoc/Test/Unit.html"><TT>Test::Unit</TT></A>
<tex2html_comment_mark>959
<A NAME="tex2html519"
  HREF="http://ruby-doc.org/stdlib-1.9.3/libdoc/test/unit/rdoc/Test/Unit/Assertions.html"><TT>Test::Unit::Assertions</TT></A>
<tex2html_comment_mark>960
):

<P>
<PRE><tex2html_verbatim_mark>verbatim1078#</PRE>

<P>
Las clases que representan tests deben ser subclases de 
<tex2html_verb_mark>1069<tex2html_verb_mark>. 
Los métodos que contienen <tex2html_verb_mark>1070<tex2html_verb_mark> deben empezar por la palabra <tex2html_verb_mark>1071<tex2html_verb_mark>.
<tex2html_verb_mark>1072<tex2html_verb_mark> utiliza introspección para decidir para encontrar que métodos debe ejecutar.

<P>
Por supuesto, si se ejecutan ahora, nuestras pruebas fallan:
<PRE><tex2html_verbatim_mark>verbatim1079#</PRE>
Idea: No podemos definir <tex2html_verb_mark>1073<tex2html_verb_mark> como una palabra clave, por supuesto, pero podemos 
producir un efecto parecido definiendo <tex2html_verb_mark>1074<tex2html_verb_mark> como un método de <tex2html_verb_mark>1075<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim1080#</PRE>

<P>
Sin embargo, esta versión no está a prueba de excepciones. Cuando ejecutamos las pruebas 
obtenemos:
<PRE><tex2html_verbatim_mark>verbatim1081#</PRE>
El mensaje nos indica la causa del fallo:
<PRE><tex2html_verbatim_mark>verbatim1082#</PRE>
Es posible también ejecutar un test específico:
<PRE><tex2html_verbatim_mark>verbatim1083#</PRE>
(Para saber mas sobre Unit Testing en Ruby vea 
<A NAME="tex2html520"
  HREF="http://en.wikibooks.org/wiki/Ruby_Programming/Unit_testing#A_Simple_Introduction">Ruby Programming/Unit testing en Wikibooks</A>).

<P>
Volviendo a nuestro fallo, recordemos que
la cláusula <tex2html_verb_mark>1076<tex2html_verb_mark> es usada cuando queremos que un código se ejecute si se produce una excepción:
<PRE><tex2html_verbatim_mark>verbatim1084#</PRE>
Pero en este caso es mejor usar la cláusula <tex2html_verb_mark>1077<tex2html_verb_mark>.
El código bajo un <tex2html_verb_mark>1078<tex2html_verb_mark> se ejecuta, tanto si se ha producido excepción como si no:

<P>
<PRE><tex2html_verbatim_mark>verbatim1085#</PRE>
Es posible utilizar <tex2html_verb_mark>1079<tex2html_verb_mark> sin la cláusula <tex2html_verb_mark>1080<tex2html_verb_mark>, y viceversa,
pero si aparecen ambas en el mismo bloque <tex2html_verb_mark>1081<tex2html_verb_mark>
entonces <tex2html_verb_mark>1082<tex2html_verb_mark> debe preceder a <tex2html_verb_mark>1083<tex2html_verb_mark>.

<P>
Reescribimos nuestro <tex2html_verb_mark>1084<tex2html_verb_mark> usando <tex2html_verb_mark>1085<tex2html_verb_mark>:
<PRE><tex2html_verbatim_mark>verbatim1086#</PRE>
Ahora los dos tests tienen éxito:
<PRE><tex2html_verbatim_mark>verbatim1087#</PRE>

<P>
Lo normal durante el desarrollo es guardar las pruebas en una carpeta con nombtre <tex2html_verb_mark>1086<tex2html_verb_mark> o <tex2html_verb_mark>1087<tex2html_verb_mark>:

<P>
<PRE><tex2html_verbatim_mark>verbatim1088#</PRE>
El problema con esta estructura es que hay que decirle a Ruby donde debe encontrar la librería
cuando se ejecutan las pruebas.

<UL>
<LI>Añadir el camino en el que están las librerías a <tex2html_verb_mark>1088<tex2html_verb_mark>
</LI>
<LI>Ejecutar los tests siempre desde el directorio raíz e incluir en los tests una línea como esta:

<P>
<PRE><tex2html_verbatim_mark>verbatim1089#</PRE>
La variable <tex2html_verb_mark>1089<tex2html_verb_mark> es una array conteniendo el PATH de búsqueda de librerías.
</LI>
</UL>

<P>
Lo habitual, cuando un proyecto crece
es que los tests se acumulen. Lo normal es clasificarlos 
por afinidades en diferentes ficheros. 
Los podemos agrupar en suites. Para ello creamos 
un fichero con una lista de <tex2html_verb_mark>1090<tex2html_verb_mark>s

<P>
<PRE><tex2html_verbatim_mark>verbatim1090#</PRE>

<P>
Ahora, simplemente ejecutando este fichero ejecutaremos todos los casos en la suite.

<P>
