<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Mejor un Sólo Agente</TITLE>
<META NAME="description" CONTENT="Mejor un Sólo Agente">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node598.html">
<LINK REL="previous" HREF="node596.html">
<LINK REL="up" HREF="node590.html">
<LINK REL="next" HREF="node598.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html13035"
  HREF="node598.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html13029"
  HREF="node590.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html13023"
  HREF="node596.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html13031"
  HREF="node735.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html13033"
  HREF="node738.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://nereida.deioc.ull.es/~lpp/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="LPP"></A><A NAME="tex2html30"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1102"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html31"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1091"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html32"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html33"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html34"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html35"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html36"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html37"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html39"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html41"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html13036"
  HREF="node598.html">Redireccionado al Agente SSH</A>
<B> Subir:</B> <A NAME="tex2html13030"
  HREF="node590.html">ssh</A>
<B> Anterior:</B> <A NAME="tex2html13024"
  HREF="node596.html">Agentes SSH</A>
 &nbsp; <B>  <A NAME="tex2html13032"
  HREF="node735.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html13034"
  HREF="node738.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION06470000000000000000">
Mejor un Sólo Agente</A>
</H1>

<P>
Si decidimos poner la línea <code>eval `ssh-agent`</code> en nuestro 
<code>~/.bash_profile</code> (véase <A NAME="tex2html1313"
  HREF="http://www.joshstaiger.org/archives/2005/07/bash_profile_vs.html">.bash_profile vs .bashrc</A>)
tenemos un problema: con cada sesión se lanza una nueva copia del agente ssh. 
Es cierto que el asunto no es preocupante si sólo abrimos una o dos cónsolas, pero
si - como es mi caso - abrimos muchas en una sesión X  tendremos que escribir la passphrase
bastantes veces. Un único agente debería ser suficiente.

<P>
Otro problema son las tareas automáticas que usan <A NAME="tex2html1314"
  HREF="http://unixhelp.ed.ac.uk/CGI/man-cgi?cron"><TT>cron</TT></A>.
Las tareas arrancadas mediante <A NAME="tex2html1315"
  HREF="http://unixhelp.ed.ac.uk/CGI/man-cgi?cron"><TT>cron</TT></A>
no heredan las variables de entorno
<code>SSH_AUTH_SOCK</code> y <code>SSH_AGENT_PID</code> y por tanto no saben
que proceso <code>ssh-agent</code> deben contactar.

<P>

<H4><A NAME="SECTION06470010000000000000">
<TT>ssh-agent</TT> y Sesiones X</A>
</H4>
  

<P>
Es común ver que en ciertos Unix el arranque de la sesión X 
lleva aparejado el arranque de un agente SSH.
Si ese es nuestro caso, tenemos la mayor parte del trabajo hecho.
Por ejemplo en una configuración típica de Kubuntu vemos lo
siguiente:

<P>
<PRE>
$ cat -n /etc/X11/Xsession.options
 1  # $Id: Xsession.options 189 2005-06-11 00:04:27Z branden $
 2  #
 3  # configuration options for /etc/X11/Xsession
 4  # See Xsession.options(5) for an explanation of the available options.
 5  allow-failsafe
 6  allow-user-resources
 7  allow-user-xsession
 8  use-ssh-agent
 9  use-session-dbus
</PRE>

<P>
La opción <code>use-ssh-agent</code> hace que se dispare un agente en el momento
de arrancar las X. En efecto si vemos los procesos en el sistema
descubrimos la presencia de un agente:
<PRE>
casiano@europa:~$ ps -fA | grep agent
casiano   6976  6911  0 10:57 ?        00:00:00 /usr/bin/ssh-agent x-session-manager
casiano   8018  7625  0 11:07 pts/3    00:00:00 grep agent
</PRE>
Viendo las variables de entorno podemos ver el lugar en el que está el socket:
<PRE>
casiano@europa:~$ env | grep -i ssh
SSH_AGENT_PID=6976
SSH_AUTH_SOCK=/tmp/ssh-qkuycC6911/agent.6911
</PRE>
Podemos ver que el socket tiene los permisos puestos para que pueda ser accedida por el usuario
que arrancó las X:
<PRE>
casiano@europa:~$ ls -ld /tmp/ssh-qkuycC6911/
drwx------ 2 casiano casiano 4096 2009-04-27 10:57 /tmp/ssh-qkuycC6911/
casiano@europa:~$ ls -l /tmp/ssh-qkuycC6911/
total 0
srw------- 1 casiano casiano 0 2009-04-27 10:57 agent.6911
</PRE>
por tanto el usuario que arrancó las X puede acceder a ese agente.
Veamos que claves están en ese agente:
<PRE>
rw------- 1 casiano casiano 0 2009-04-27 10:57 agent.6911
casiano@europa:~$ ssh-add -l
1024 49:4c:e1:b4:1a:ea:e6:73:fc:a1:e5:6b:54:c9:da:62 /home/casiano/.ssh/id_dsa (DSA)
</PRE>
Ya esta la clave <code>/home/casiano/.ssh/id_dsa</code>. 
Probablemente lo haya hecho en alguna prueba anterior.
Para empezar esta nueva prueba desde una situación inicial
vamos a suprimir todas las claves del agente.
<PRE>
casiano@europa:~$ ssh-add -D
All identities removed.
</PRE>
Si ahora intento conectarme a una máquina con esa clave,
me es solicitada la passphrase:
<PRE>
casiano@europa:~$ ssh orion
Enter passphrase for key '/home/casiano/.ssh/id_dsa':
^C
</PRE>
Interrumpo la conexión pulsando CTRL-C y paso a añadir la 
clave al agente:
<PRE>
casiano@europa:~$ ssh-add /home/casiano/.ssh/id_dsa
Enter passphrase for /home/casiano/.ssh/id_dsa:
Identity added: /home/casiano/.ssh/id_dsa (/home/casiano/.ssh/id_dsa)
</PRE>
Ahora puedo hacer la conexión sin necesidad de introducir la passphrase:
<PRE>
casiano@europa:~$ ssh orion
Linux orion 2.6.8-2-686 #1 Tue Aug 16 13:22:48 UTC 2005 i686 GNU/Linux
</PRE>

<P>

<H4><A NAME="SECTION06470020000000000000">
Arrancando el Agente en KDE</A>
</H4>
  

<P>
Una solución parcial es arrancar el agente tan pronto como se inicia la sesión
del escritorio. El siguiente procedimiento funciona en un escritorio 
KDE: 

<P>

<UL>
<LI>Cree <code>/.kde/env/ssh-agent.sh</code>
<PRE>
mkdir ~/.kde/env
vim ~/.kde/env/ssh-agent.sh
chmod u+x ~/.kde/env/ssh-agent.sh
</PRE>
con estos contenidos:
<PRE>
someone@localhost:~/.kde/env$ cat -n ssh-agent.sh
     1  #!/bin/sh
     2  /usr/bin/ssh-agent -s &gt; $HOME/.ssh/agent-env.sh
     3  $HOME/.ssh/agent-env.sh &gt; /dev/null
</PRE>

<P>
La opción <code>-s</code> de <A NAME="tex2html1316"
  HREF="http://unixhelp.ed.ac.uk/CGI/man-cgi?ssh-agent"><TT>ssh-agent</TT></A>
le indica que debe generar 
comandos de Bourne shell en stdout.
Esta es la conducta por defecto a menos que <code>SHELL</code>
sea de la familia de shells <code>csh</code>.
La alternativa es usar la opción <code>-c</code> la cual genera comandos
C-shell. Esta es la conducta por defecto si <code>SHELL</code> 
es <code>csh</code> o <code>tcsh</code>.

<P>
La redirección de la línea 2 produce el guión que es ejecutado en la línea 3:

<P>
<PRE>
someone@localhost:~/src$ cat $HOME/.ssh/agent-env.sh
SSH_AUTH_SOCK=/tmp/ssh-LDdzn31114/agent.31114; export SSH_AUTH_SOCK;
SSH_AGENT_PID=31115; export SSH_AGENT_PID;
echo Agent pid 31115;
</PRE>

<P>
</LI>
<LI>Cree <code>~/.kde/shutdown</code>:

<P>
<PRE>
mkdir ~/.kde/shutdown
vim ~/.kde/shutdown/shutdown-ssh.sh
chmod u+x ~/.kde/shutdown/shutdown-ssh.sh
</PRE>

<P>
con los siguientes contenidos:

<P>
<PRE>
someone@localhost:~/.kde/shutdown$ cat -n shutdown-ssh.sh
     1  #!/bin/sh
     2  /usr/bin/ssh-agent -k
</PRE>

<P>
</LI>
</UL>

<P>
La opción recomendada es aprovechar el agente ssh creado al arrancar las X.
Puede que quiera que las identidades se añadan tan pronto como entra en su
escritorio KDE. En ese caso cambie los contenidos de <code>/.kde/env/ssh-agent.sh</code>
por algo parecido a esto:
<PRE>
someone@localhost:~/.kde/env$ cat -n ssh-agent.sh
     1  #!/bin/sh
     2  /usr/bin/ssh-add $HOME/.ssh/id_dsa
     3  /usr/bin/ssh-add $HOME/.ssh/thatmachinebackupidentity
</PRE>

<P>

<H4><A NAME="SECTION06470030000000000000">
Introducción a <TT>keychain</TT></A>
</H4>
  

<P>
La metodología usada en los párrafos anteriores no es válida si
no somos el usuario que arranca las X. Este es el caso si estamos
ya en una sesión <code>ssh</code> o hemos cambiado de usuario 
ejecutando <A NAME="tex2html1317"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=su"><TT>su</TT></A>
(switch user) 
o bien queremos ejecutar un proceso por lotes bajo un <A NAME="tex2html1318"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=cron"><TT>cron</TT></A>.

<P>
En estos casos <A NAME="tex2html1319"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
puede ayudar.

<P>

<H4><A NAME="SECTION06470040000000000000">
Suprimiendo los Agentes Activos con <TT>keychain</TT></A>
</H4>
  

<P>
Comencemos usando la opción <code>-k</code> para suprimir los
agentes activos y asegurarnos que  empezamos desde una
situación inicial:

<P>
<PRE>
lusasoft@LusaSoft:~/.ssh$ keychain -k all

KeyChain 2.6.8; http://www.gentoo.org/proj/en/keychain/
Copyright 2002-2004 Gentoo Foundation; Distributed under the GPL

 * All lusasoft's ssh-agent(s) (5678) are now stopped
 * All lusasoft's gpg-agent(s) (6823) are now stopped
</PRE>

<P>
La opción <code>-k</code> tiene la sintáxis:
<PRE>
     -k which
</PRE>
Las siguientes opciones son válidas para <code>which</code>:

<P>

<UL>
<LI><code>all</code>  eliminar a todos los agentes y terminar 
</LI>
<LI><code>others</code> eliminar a los agentes que no sean de <A NAME="tex2html1320"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
</LI>
<LI><code>mine</code> eliminar a los agentes <A NAME="tex2html1321"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
dejando el resto.
</LI>
</UL>

<P>

<H4><A NAME="SECTION06470050000000000000">
Funcionamiento de <TT>keychain</TT></A>
</H4>
  

<P>
Cuando se ejecuta <A NAME="tex2html1322"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
comprueba si existe ya un agente <A NAME="tex2html1323"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=ssh-agent"><TT>ssh-agent</TT></A>
ejecutándose.
Si no es el caso arranca uno. Si existe no cargará uno nuevo. Sin embargo
es necesario que el usuario o el script llamen a <code>~/.keychain/europa-sh</code>
para tener acceso al agente.

<P>
<PRE>
lusasoft@LusaSoft:~/.ssh$ keychain ~/.ssh/id_dsa

KeyChain 2.6.8; http://www.gentoo.org/proj/en/keychain/
Copyright 2002-2004 Gentoo Foundation; Distributed under the GPL

 * Initializing /home/lusasoft/.keychain/LusaSoft-sh file...
 * Initializing /home/lusasoft/.keychain/LusaSoft-csh file...
 * Initializing /home/lusasoft/.keychain/LusaSoft-fish file...
 * Starting ssh-agent
 * Initializing /home/lusasoft/.keychain/LusaSoft-sh-gpg file...
 * Initializing /home/lusasoft/.keychain/LusaSoft-csh-gpg file...
 * Initializing /home/lusasoft/.keychain/LusaSoft-fish-gpg file...
 * Starting gpg-agent
 * Adding 1 ssh key(s)...
Identity added: /home/lusasoft/.ssh/id_dsa (/home/lusasoft/.ssh/id_dsa)
</PRE>
Salva las variables de entorno en <code>~/.keychain/${HOSTNAME}-sh</code>,
<PRE>
lusasoft@LusaSoft:~$ tree .keychain/
.keychain/
|-- LusaSoft-csh
|-- LusaSoft-csh-gpg
|-- LusaSoft-fish
|-- LusaSoft-fish-gpg
|-- LusaSoft-sh
`-- LusaSoft-sh-gpg
</PRE>
Estos ficheros contienen los comandos para establecer las variables de entorno.
Por ejemplo:
<PRE>
$ cat -n .keychain/europa-sh
     1  SSH_AUTH_SOCK=/tmp/ssh-ctTDo22823/agent.22823; export SSH_AUTH_SOCK;
     2  SSH_AGENT_PID=22824; export SSH_AGENT_PID;
</PRE>
De este modo las subsiguientes llamadas no interactivas a <A NAME="tex2html1324"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=ssh"><TT>ssh</TT></A>
- por ejemplo, cron jobs - pueden hacer un <code>source</code> del correspondiente
guión y conectarse con el único agente obviando asi la necesidad de solicitar las claves. 
<PRE>
$ source ~/.keychain/europa-sh
$ ssh orion
Linux orion 2.6.8-2-686 #1 Tue Aug 16 13:22:48 UTC 2005 i686 GNU/Linux
</PRE>
Si abrimos otra terminal deberemos hacer de nuevo la llamada a <code>source ~/.keychain/europa-sh</code>.
Por supuesto, lo mejor es poner la llamada a <code>keychain</code> y a <code>source ~/.keychain/europa-sh</code>
en nuestro fichero de arranque <code>~/.bashrc</code> o <code>bash_profile</code>.

<P>
<PRE>
/usr/bin/keychain ~/.ssh/id_dsa
source ~/.keychain/europa-sh
</PRE>

<P>

<H4><A NAME="SECTION06470060000000000000">
Cuando el Agente no Conoce la Clave</A>
</H4>
  

<P>
Cuando se ejecuta, <A NAME="tex2html1325"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
verifica que la clave especificada 
es conocida por el agente. Si no es así nos solicitará la passphrase.

<P>
Véase la siguiente secuencia de comandos. 
Primero ponemos una passphrase a la identidad por defecto:

<P>
<PRE>
lusasoft@LusaSoft:~$ ssh-keygen -p
Enter file in which the key is (/home/lusasoft/.ssh/id_rsa): /home/lusasoft/.ssh/id_dsa
Key has comment '/home/lusasoft/.ssh/id_dsa'
Enter new passphrase (empty for no passphrase): ***************
Enter same passphrase again: ***************
Your identification has been saved with the new passphrase.
</PRE>
A continuación limpiamos los agentes:
<PRE>
lusasoft@LusaSoft:~$ keychain --clear

KeyChain 2.6.8; http://www.gentoo.org/proj/en/keychain/
Copyright 2002-2004 Gentoo Foundation; Distributed under the GPL

 * Found existing ssh-agent (6927)
 * Found existing gpg-agent (6951)
 * ssh-agent: All identities removed.
 * gpg-agent: All identities removed.
</PRE>

<P>
Cargamos de nuevo <A NAME="tex2html1326"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
con la identidad por defecto:
<PRE>
lusasoft@LusaSoft:~$ keychain ~/.ssh/id_dsa

KeyChain 2.6.8; http://www.gentoo.org/proj/en/keychain/
Copyright 2002-2004 Gentoo Foundation; Distributed under the GPL

 * Found existing ssh-agent (6927)
 * Found existing gpg-agent (6951)
 * Adding 1 ssh key(s)...
Identity added: /home/lusasoft/.ssh/id_dsa (/home/lusasoft/.ssh/id_dsa)
</PRE>
Ahora se nos solicita la passphrase (por defecto mediante <A NAME="tex2html1327"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=ssh-askpass"><TT>ssh-askpass</TT></A>).
Después de escribirla la identidad es añadida al agente.

<P>
<PRE>
lusasoft@LusaSoft:~$ keychain --nogui ~/.ssh/id_dsa

KeyChain 2.6.8; http://www.gentoo.org/proj/en/keychain/
Copyright 2002-2004 Gentoo Foundation; Distributed under the GPL

 * Found existing ssh-agent (6927)
 * Found existing gpg-agent (6951)
 * Adding 1 ssh key(s)...
Enter passphrase for /home/lusasoft/.ssh/id_dsa: *********************
Identity added: /home/lusasoft/.ssh/id_dsa (/home/lusasoft/.ssh/id_dsa)
</PRE>

<P>

<H4><A NAME="SECTION06470070000000000000">
Tipos de Agentes</A>
</H4>
  

<P>
<A NAME="tex2html1328"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
soporta también <A NAME="tex2html1329"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=gpg-agent"><TT>gpg-agent</TT></A>. Por defecto arranca 
todos los agentes disponibles. Se puede limitar los agentes arrancados
usando la opción <code>--agents</code>. Por ejemplo <code>--agents 'gpg,ssh'</code>

<P>

<H4><A NAME="SECTION06470080000000000000">
Agentes en Mal Estado</A>
</H4>
  

<P>
La llamada a <code>keychain</code> creará un nuevo 
agente si el fichero <code>/home/pp2/.keychain/europa-sh</code> queda obsoleto
(por ejemplo, si <code>SSH_AUTH_SOCK</code> referencia un socket que no existe
o no existe un proceso con pid el referenciado en <code>SSH_AGENT_PID</code>).
Véase la siguiente sesión de comandos:

<P>
<PRE>
pp2@europa:~$ ps -fA | grep agent
casiano   6976  6911  0 10:57 ?        00:00:00 /usr/bin/ssh-agent x-session-manager
pp2      22824     1  0 12:42 ?        00:00:00 ssh-agent
pp2      22848     1  0 12:42 ?        00:00:00 gpg-agent --daemon
pp2      32569 30843  0 13:06 pts/13   00:00:00 grep agent
pp2@europa:~$ kill -9 22824
pp2@europa:~$ ps -fA | grep agent
pp2       3165 30843  0 13:07 pts/13   00:00:00 grep agent
casiano   6976  6911  0 10:57 ?        00:00:00 /usr/bin/ssh-agent x-session-manager
pp2      22848     1  0 12:42 ?        00:00:00 gpg-agent --daemon
pp2@europa:~$ keychain

KeyChain 2.6.8; http://www.gentoo.org/proj/en/keychain/
Copyright 2002-2004 Gentoo Foundation; Distributed under the GPL

 * Initializing /home/pp2/.keychain/europa-sh file...
 * Initializing /home/pp2/.keychain/europa-csh file...
 * Initializing /home/pp2/.keychain/europa-fish file...
 * Starting ssh-agent
 * Found existing gpg-agent (22848)

pp2@europa:~$ ps -fA | grep agent
pp2       3198     1  0 13:07 ?        00:00:00 ssh-agent
pp2       3225 30843  0 13:08 pts/13   00:00:00 grep agent
casiano   6976  6911  0 10:57 ?        00:00:00 /usr/bin/ssh-agent x-session-manager
pp2      22848     1  0 12:42 ?        00:00:00 gpg-agent --daemon
</PRE>

<P>

<H4><A NAME="SECTION06470090000000000000">
La opción <TT>-eval</TT> de <TT>keychain</TT></A>
</H4>
  

<P>
La opción <code>-eval</code> de <A NAME="tex2html1330"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
hace que 
<A NAME="tex2html1331"
  HREF="http://manpages.debian.net/cgi-bin/man.cgi?query=keychain"><TT>keychain</TT></A>
envíe a stdout el contenido del script.
Así podemos arrancar el agente y añadirle la clave en un paso con:
<PRE>
pp2@europa:~/Lbook$ eval `keychain -eval ~/.ssh/id_dsa`
</PRE>

<P>

<H4><A NAME="SECTION064700100000000000000">
Véase También</A>
</H4>
  

<P>

<UL>
<LI><A NAME="tex2html1332"
  HREF="http://www.ibm.com/developerworks/linux/library/l-keyc.html">Common threads: OpenSSH key management, Part 1: 
Understanding RSA/DSA authentication</A>
</LI>
<LI><A NAME="tex2html1333"
  HREF="http://www.ibm.com/developerworks/linux/library/l-keyc2/">Common threads: OpenSSH key management, Part 2:
Introducing ssh agent and keychain</A>
</LI>
<LI><A NAME="tex2html1334"
  HREF="http://www.ibm.com/developerworks/linux/library/l-keyc3/">Common threads: OpenSSH key management, Part 3:
Agent forwarding and keychain improvements</A>
</LI>
<LI><A NAME="tex2html1335"
  HREF="http://www.ibm.com/developerworks/linux/library/l-backup/">Automate backups on Linux. No excuses: do-it-yourself, secure, distributed network backups made easy</A>
</LI>
<LI><A NAME="tex2html1336"
  HREF="http://www.gentoo.org/proj/en/keychain/">keychain en Gentoo</A>
</LI>
</UL>

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><UL>
<LI><A NAME="tex2html13037"
  HREF="node597.html#SECTION06470010000000000000"><TT>ssh-agent</TT> y Sesiones X</A>
<LI><A NAME="tex2html13038"
  HREF="node597.html#SECTION06470020000000000000">Arrancando el Agente en KDE</A>
<LI><A NAME="tex2html13039"
  HREF="node597.html#SECTION06470030000000000000">Introducción a <TT>keychain</TT></A>
<LI><A NAME="tex2html13040"
  HREF="node597.html#SECTION06470040000000000000">Suprimiendo los Agentes Activos con <TT>keychain</TT></A>
<LI><A NAME="tex2html13041"
  HREF="node597.html#SECTION06470050000000000000">Funcionamiento de <TT>keychain</TT></A>
<LI><A NAME="tex2html13042"
  HREF="node597.html#SECTION06470060000000000000">Cuando el Agente no Conoce la Clave</A>
<LI><A NAME="tex2html13043"
  HREF="node597.html#SECTION06470070000000000000">Tipos de Agentes</A>
<LI><A NAME="tex2html13044"
  HREF="node597.html#SECTION06470080000000000000">Agentes en Mal Estado</A>
<LI><A NAME="tex2html13045"
  HREF="node597.html#SECTION06470090000000000000">La opción <TT>-eval</TT> de <TT>keychain</TT></A>
<LI><A NAME="tex2html13046"
  HREF="node597.html#SECTION064700100000000000000">Véase También</A>
</UL></UL></UL>
<!--End of Table of Child-Links-->

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html13035"
  HREF="node598.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html13029"
  HREF="node590.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html13023"
  HREF="node596.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html13031"
  HREF="node735.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html13033"
  HREF="node738.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://nereida.deioc.ull.es/~lpp/index.html"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="logoLPP.png"
 ALT="LPP"></A><A NAME="tex2html30"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1102"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html31"
  HREF="http://campusvirtual.ull.es/1314/course/view.php?id=1091"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html32"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html33"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html34"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html35"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html36"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html37"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html39"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html41"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html13036"
  HREF="node598.html">Redireccionado al Agente SSH</A>
<B> Subir:</B> <A NAME="tex2html13030"
  HREF="node590.html">ssh</A>
<B> Anterior:</B> <A NAME="tex2html13024"
  HREF="node596.html">Agentes SSH</A>
 &nbsp; <B>  <A NAME="tex2html13032"
  HREF="node735.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html13034"
  HREF="node738.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-09-02
</ADDRESS>
</BODY>
</HTML>
