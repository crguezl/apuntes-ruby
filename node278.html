<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Dos DSLs: Generando XML con Validación via Generación de Métodos</TITLE>
<META NAME="description" CONTENT="Dos DSLs: Generando XML con Validación via Generación de Métodos">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="next" HREF="node279.html">
<LINK REL="previous" HREF="node277.html">
<LINK REL="up" HREF="node275.html">
<LINK REL="next" HREF="node279.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html7936"
  HREF="node279.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html7930"
  HREF="node275.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html7924"
  HREF="node277.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html7932"
  HREF="node851.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html7934"
  HREF="node854.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html7937"
  HREF="node279.html">Creando un ORM</A>
<B> Subir:</B> <A NAME="tex2html7931"
  HREF="node275.html">Lenguajes de Dominio Específico.</A>
<B> Anterior:</B> <A NAME="tex2html7925"
  HREF="node277.html">Un DSL para Procesar</A>
 &nbsp; <B>  <A NAME="tex2html7933"
  HREF="node851.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html7935"
  HREF="node854.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><A NAME="tex2html7938"
  HREF="node278.html#SECTION028123010000000000000">Primer DSL: Lenguaje para la Generación de XML</A>
<LI><A NAME="tex2html7939"
  HREF="node278.html#SECTION028123020000000000000">XML Generado</A>
<LI><A NAME="tex2html7940"
  HREF="node278.html#SECTION028123030000000000000">Visualización del HTML Generado</A>
<LI><A NAME="tex2html7941"
  HREF="node278.html#SECTION028123040000000000000">Segundo DSL: Lenguaje para la Generación del DSL Anterior y su Validación</A>
<LI><A NAME="tex2html7942"
  HREF="node278.html#SECTION028123050000000000000">La Clase <TT>XMLGrammar</TT></A>
<LI><A NAME="tex2html7943"
  HREF="node278.html#SECTION028123060000000000000">Código Completo</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION028123000000000000000">
Dos DSLs: Generando XML con Validación via Generación de Métodos</A>
</H2>

<P>

<H4><A NAME="SECTION028123010000000000000">
Primer DSL: Lenguaje para la Generación de XML</A>
</H4>
  

<PRE>
HTMLForm.generate(STDOUT) do
  comment "This is a simple HTML form"
  form :name =&gt; "registration",
       :action =&gt; "http://www.example.com/register.cgi" do
    content "Name:"
    br
    input :name =&gt; "name"
    br
    content "Post:"
    br
    textarea :name =&gt; "address", :rows=&gt;6, :cols=&gt;40 do
      "Please enter your post here"        # Este bloque retorna contenido
    end
    br
    button { "Submit" }                    # Este bloque retorna contenido
  end
end
</PRE>

<P>

<H4><A NAME="SECTION028123020000000000000">
XML Generado</A>
</H4>
  

<P>
<PRE>
[xmlgenerator]$ ruby xml_generator.rb &gt; ejemplo.html
</PRE>

<P>
<PRE>
[xmlgenerator]$ cat ejemplo.html 
&lt;!-- This is a simple HTML form --&gt;
&lt;form name='registration' action='http://www.example.com/register.cgi' method='GET' enctype='application/x-www-form-urlencoded'&gt;Name:&lt;br/&gt;
&lt;input name='name' type='text'/&gt;
&lt;br/&gt;
Post:&lt;br/&gt;
&lt;textarea name='address' rows='6' cols='40'&gt;Please enter your post here&lt;/textarea&gt;
&lt;br/&gt;
&lt;button type='submit'&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</PRE>

<P>

<H4><A NAME="SECTION028123030000000000000">
Visualización del HTML Generado</A>
</H4>
  

<P>

<img src="form.png" width="75%" />


<P>

<H4><A NAME="SECTION028123040000000000000">
Segundo DSL: Lenguaje para la Generación del DSL Anterior y su Validación</A>
</H4>
  

<P>
Este DSL permite describir una gramática XML: que tags son permitidos
y para cada tag que atributos son legales y de que tipo son.
Se usaría así:

<P>
<PRE>
class HTMLForm &lt; XMLGrammar
  element :form, :action =&gt; REQ,        # atributo requerido
                 :method =&gt; "GET",      # cadena: valor por defecto
                 :enctype =&gt; "application/x-www-form-urlencoded",
                 :name =&gt; OPT           # opcional
  element :input, :type =&gt; "text", :name =&gt; OPT, :value =&gt; OPT,
                  :maxlength =&gt; OPT, :size =&gt; OPT, :src =&gt; OPT,
                  :checked =&gt; BOOL, :disabled =&gt; BOOL, :readonly =&gt; BOOL
  element :textarea, :rows =&gt; REQ, :cols =&gt; REQ, :name =&gt; OPT,
                     :disabled =&gt; BOOL, :readonly =&gt; BOOL
  element :button, :name =&gt; OPT, :value =&gt; OPT,
                   :type =&gt; "submit", :disabled =&gt; OPT
  element :br
end
</PRE>

<P>
El método <code>element</code> construye un método de instancia 
con el nombre especificado (por ejemplo, <code>:form</code>) como primer
argumento en la subclase (<code>HTMLForm</code> en el ejemplo).
Como segundo argumento opcional recibe un hash especificando los atributos 
legales del elemento y de que tipo son (<code>REQ</code> por requerido, <code>OPT</code> por opcional,
una <A NAME="tex2html585"
  HREF="http://ruby-doc.org/core-2.0.0/String.html"><TT>String</TT></A> como en <code>:method =&gt; "GET"</code> indica valor por defecto y <code>BOOL</code> para atributos
cuyo valor es su propio nombre.

<P>
En el código anterior se crean métodos <code>form</code>, <code>input</code>, <code>texarea</code>, <code>button</code>
y <code>br</code> en la clase <code>HTMLForm</code>.

<P>

<H4><A NAME="SECTION028123050000000000000">
La Clase <TT>XMLGrammar</TT></A>
</H4>
  

<P>
<PRE>
class XMLGrammar
  # Create an instance of this class, specifying a stream or object to
  # hold the output. This can be any object that responds to &lt;&lt;(String).
  def initialize(out)
    @out = out  # Remember where to send our output
  end

  # Invoke the block in an instance that outputs to the specified stream.
  def self.generate(out, &amp;block)
    new(out).instance_eval(&amp;block)
  end

  # Define an allowed element (or tag) in the grammar.
  # This class method is the grammar-specification DSL
  # and defines the methods that constitute the XML-output DSL.
  def self.element(tagname, attributes={})
    @allowed_attributes ||= {}
    @allowed_attributes[tagname] = attributes

    class_eval %Q{
      def #{tagname}(attributes={}, &amp;block)
        tag(:#{tagname},attributes,&amp;block)
      end
    }
  end

  # These are constants used when defining attribute values.
  OPT = :opt     # for optional attributes
  REQ = :req     # for required attributes
  BOOL = :bool   # for attributes whose value is their own name

  def self.allowed_attributes
    @allowed_attributes
  end

  # Output the specified object as CDATA, return nil.
  def content(text)
    @out &lt;&lt; text.to_s
    nil
  end

  # Output the specified object as a comment, return nil.
  def comment(text)
    @out &lt;&lt; "&lt;!-- #{text} --&gt;\n"
    nil
  end

  # Output a tag with the specified name and attribute.
  # If there is a block, invoke it to output or return content.
  # Return nil.
  def tag(tagname, attributes={})
    # Output the tag name
    @out &lt;&lt; "&lt;#{tagname}"

    # Get the allowed attributes for this tag.
    allowed = self.class.allowed_attributes[tagname]

    # First, make sure that each of the attributes is allowed.
    # Assuming they are allowed, output all of the specified ones.
    attributes.each_pair do |key,value|
      raise "unknown attribute: #{key}" unless allowed.include?(key)
      @out &lt;&lt; " #{key}='#{value}'"
    end

    # Now look through the allowed attributes, checking for 
    # required attributes that were omitted and for attributes with
    # default values that we can output.
    allowed.each_pair do |key,value|
      # If this attribute was already output, do nothing.
      next if attributes.has_key? key
      if (value == REQ)
        raise "required attribute '#{key}' missing in &lt;#{tagname}&gt;"
      elsif value.is_a? String
        @out &lt;&lt; " #{key}='#{value}'"
      end
    end

    if block_given?
      # This block has content
      @out &lt;&lt; '&gt;'             # End the opening tag
      content = yield         # Invoke the block to output or return content
      if content              # If any content returned
        @out &lt;&lt; content.to_s  # Output it as a string
      end
      @out &lt;&lt; "&lt;/#{tagname}&gt;\n" # Close the tag
    else 
      # Otherwise, this is an empty tag, so just close it.
      @out &lt;&lt; "/&gt;\n"
    end
    nil # Tags output themselves, so they don't return any content.
  end
end
</PRE>

<P>

<H4><A NAME="SECTION028123060000000000000">
Código Completo</A>
</H4>
  

<P>
<PRE>
class XMLGrammar
  # Create an instance of this class, specifying a stream or object to
  # hold the output. This can be any object that responds to &lt;&lt;(String).
  def initialize(out)
    @out = out  # Remember where to send our output
  end

  # Invoke the block in an instance that outputs to the specified stream.
  def self.generate(out, &amp;block)
    new(out).instance_eval(&amp;block)
  end

  # Define an allowed element (or tag) in the grammar.
  # This class method is the grammar-specification DSL
  # and defines the methods that constitute the XML-output DSL.
  def self.element(tagname, attributes={})
    @allowed_attributes ||= {}
    @allowed_attributes[tagname] = attributes

    class_eval %Q{
      def #{tagname}(attributes={}, &amp;block)
        tag(:#{tagname},attributes,&amp;block)
      end
    }
  end

  # These are constants used when defining attribute values.
  OPT = :opt     # for optional attributes
  REQ = :req     # for required attributes
  BOOL = :bool   # for attributes whose value is their own name

  def self.allowed_attributes
    @allowed_attributes
  end

  # Output the specified object as CDATA, return nil.
  def content(text)
    @out &lt;&lt; text.to_s
    nil
  end

  # Output the specified object as a comment, return nil.
  def comment(text)
    @out &lt;&lt; "&lt;!-- #{text} --&gt;\n"
    nil
  end

  # Output a tag with the specified name and attribute.
  # If there is a block, invoke it to output or return content.
  # Return nil.
  def tag(tagname, attributes={})
    # Output the tag name
    @out &lt;&lt; "&lt;#{tagname}"

    # Get the allowed attributes for this tag.
    allowed = self.class.allowed_attributes[tagname]

    # First, make sure that each of the attributes is allowed.
    # Assuming they are allowed, output all of the specified ones.
    attributes.each_pair do |key,value|
      raise "unknown attribute: #{key}" unless allowed.include?(key)
      @out &lt;&lt; " #{key}='#{value}'"
    end

    # Now look through the allowed attributes, checking for 
    # required attributes that were omitted and for attributes with
    # default values that we can output.
    allowed.each_pair do |key,value|
      # If this attribute was already output, do nothing.
      next if attributes.has_key? key
      if (value == REQ)
        raise "required attribute '#{key}' missing in &lt;#{tagname}&gt;"
      elsif value.is_a? String
        @out &lt;&lt; " #{key}='#{value}'"
      end
    end

    if block_given?
      # This block has content
      @out &lt;&lt; '&gt;'             # End the opening tag
      content = yield         # Invoke the block to output or return content
      if content              # If any content returned
        @out &lt;&lt; content.to_s  # Output it as a string
      end
      @out &lt;&lt; "&lt;/#{tagname}&gt;\n" # Close the tag
    else 
      # Otherwise, this is an empty tag, so just close it.
      @out &lt;&lt; "/&gt;\n"
    end
    nil # Tags output themselves, so they don't return any content.
  end
end

class HTMLForm &lt; XMLGrammar
  element :form, :action =&gt; REQ,
                 :method =&gt; "GET",
                 :enctype =&gt; "application/x-www-form-urlencoded",
                 :name =&gt; OPT
  element :input, :type =&gt; "text", :name =&gt; OPT, :value =&gt; OPT,
                  :maxlength =&gt; OPT, :size =&gt; OPT, :src =&gt; OPT,
                  :checked =&gt; BOOL, :disabled =&gt; BOOL, :readonly =&gt; BOOL
  element :textarea, :rows =&gt; REQ, :cols =&gt; REQ, :name =&gt; OPT,
                     :disabled =&gt; BOOL, :readonly =&gt; BOOL
  element :button, :name =&gt; OPT, :value =&gt; OPT,
                   :type =&gt; "submit", :disabled =&gt; OPT
  element :br
end

HTMLForm.generate(STDOUT) do
  comment "This is a simple HTML form"
  form :name =&gt; "registration",
       :action =&gt; "http://www.example.com/register.cgi" do
    content "Name:"
    br
    input :name =&gt; "name"
    br
    content "Post:"
    br
    textarea :name =&gt; "address", :rows=&gt;6, :cols=&gt;40 do
      "Please enter your post here"
    end
    br
    button { "Submit" }
  end
end
</PRE>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html7936"
  HREF="node279.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html7930"
  HREF="node275.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html7924"
  HREF="node277.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html7932"
  HREF="node851.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html7934"
  HREF="node854.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html7937"
  HREF="node279.html">Creando un ORM</A>
<B> Subir:</B> <A NAME="tex2html7931"
  HREF="node275.html">Lenguajes de Dominio Específico.</A>
<B> Anterior:</B> <A NAME="tex2html7925"
  HREF="node277.html">Un DSL para Procesar</A>
 &nbsp; <B>  <A NAME="tex2html7933"
  HREF="node851.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html7935"
  HREF="node854.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-12-11
</ADDRESS>
</BODY>
</HTML>
