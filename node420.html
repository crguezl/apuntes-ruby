<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Rspec con Rack</TITLE>
<META NAME="description" CONTENT="Rspec con Rack">
<META NAME="keywords" CONTENT="perlexamples">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="mystyle.css">

<LINK REL="previous" HREF="node419.html">
<LINK REL="up" HREF="node418.html">
<LINK REL="next" HREF="node421.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html10600"
  HREF="node421.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html10594"
  HREF="node418.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html10590"
  HREF="node419.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html10596"
  HREF="node849.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html10598"
  HREF="node852.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html10601"
  HREF="node421.html">Práctica: Añada Pruebas a</A>
<B> Subir:</B> <A NAME="tex2html10595"
  HREF="node418.html">Pruebas/Testing</A>
<B> Anterior:</B> <A NAME="tex2html10591"
  HREF="node419.html">Pruebas Unitarias</A>
 &nbsp; <B>  <A NAME="tex2html10597"
  HREF="node849.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html10599"
  HREF="node852.html">&#205;ndice de Materias</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsecciones</STRONG></A>

<UL CLASS="ChildLinks">
<LI><UL>
<LI><A NAME="tex2html10602"
  HREF="node420.html#SECTION031272010000000000000">Véase</A>
<LI><A NAME="tex2html10603"
  HREF="node420.html#SECTION031272020000000000000">Jerarquía</A>
<LI><A NAME="tex2html10604"
  HREF="node420.html#SECTION031272030000000000000">lib/rsack.rb</A>
<LI><A NAME="tex2html10605"
  HREF="node420.html#SECTION031272040000000000000">lib/rsack/server.rb</A>
<LI><A NAME="tex2html10606"
  HREF="node420.html#SECTION031272050000000000000">spec/rsack/server_spec.rb</A>
<LI><A NAME="tex2html10607"
  HREF="node420.html#SECTION031272060000000000000">spec/spec_helper.rb</A>
<LI><A NAME="tex2html10608"
  HREF="node420.html#SECTION031272070000000000000">Rakefile</A>
<LI><A NAME="tex2html10609"
  HREF="node420.html#SECTION031272080000000000000">Gemfile</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION031272000000000000000"></A>
<A NAME="subsection:rspecconrack"></A>
<BR>
Rspec con Rack
</H2>

<P>

<H4><A NAME="SECTION031272010000000000000">
Véase</A>
</H4>
  

<OL>
<LI>Los fuentes de este ejemplo están en:
<A NAME="tex2html1007"
  HREF="https://github.com/crguezl/rack-rspec">https://github.com/crguezl/rack-rspec</A>
</LI>
<LI><A NAME="tex2html1008"
  HREF="http://youtu.be/FV6AQEKxBOg">Using RSpec with Rack</A>
en Youtube por 
<A NAME="tex2html1009"
  HREF="https://github.com/mikbe?tab=repositories">Mike Bethany</A>
</LI>
<LI>Documentación en rubydoc.info del módulo Rack::MockSession
<A NAME="tex2html1010"
  HREF="http://rdoc.info/github/brynary/rack-test/master/Rack/MockSession">http://rdoc.info/github/brynary/rack-test/master/Rack/MockSession</A>
</LI>
<LI><A NAME="tex2html1011"
  HREF="https://github.com/rack/rack/blob/master/lib/rack/mock.rb">Código fuente en lib/rack/mock.rb</A>
</LI>
<LI>Documentación en rubydoc.info del módulo Rack::Test::Methods:
<A NAME="tex2html1012"
  HREF="http://rdoc.info/github/brynary/rack-test/master/Rack/Test/Methods">http://rdoc.info/github/brynary/rack-test/master/Rack/Test/Methods</A>
</LI>
<LI>Documentación de <A NAME="tex2html1013"
  HREF="http://rdoc.info/github/brynary/rack-test/master/Rack/Test/Session">Rack::Test::Session</A>
</LI>
<LI><A NAME="tex2html1014"
  HREF="https://github.com/bblimke/webmock">webmock</A>
gem
</LI>
<LI><A NAME="tex2html1015"
  HREF="http://rubydoc.info/github/rack/rack/master/Rack/MockRequest">Class: Rack::MockRequest documentation</A>
</LI>
<LI><A NAME="tex2html1016"
  HREF="http://robots.thoughtbot.com/how-to-test-sinatra-based-web-services">How to Test Sinatra-Based Web Services by Harlow Ward, March 17, 2013</A>
Webmock
Written by thoughtbot Harlow Ward
March 17, 2013
</LI>
</OL>

<P>

<H4><A NAME="SECTION031272020000000000000">
Jerarquía</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ tree
.
|--- Gemfile
|--- Gemfile.lock
|--- README
|--- Rakefile
|--- lib
|   |--- rsack
|   |   `--- server.rb
|   `--- rsack.rb
`--- spec
    |--- rsack
    |   `--- server_spec.rb
    `--- spec_helper.rb

4 directories, 8 files
</PRE>

<P>

<H4><A NAME="SECTION031272030000000000000">
lib/rsack.rb</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ cat lib/rsack.rb 
require 'rack'
require 'rsack/server'
</PRE>

<P>

<H4><A NAME="SECTION031272040000000000000">
lib/rsack/server.rb</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ cat lib/rsack/server.rb 
module Rsack
  class Server
    def call(env)
      #["200", {}, "hello"]
      response = Rack::Response.new
      response.write("Hello world!")
      response.finish
    end
  end
end
</PRE>

<P>

<H4><A NAME="SECTION031272050000000000000">
spec/rsack/server_spec.rb</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ cat spec/rsack/server_spec.rb 
require 'spec_helper'

describe Rsack::Server do

  #let(:server) { Rack::MockRequest.new(Rsack::Server.new) }
  def server
    Rack::MockRequest.new(Rsack::Server.new) 
  end

  context '/' do
    it "should return a 200 code" do
      response = server.get('/')
      response.status.should == 200
    end
  end
end
</PRE>
<A NAME="tex2html1017"
  HREF="http://rack.rubyforge.org/doc/classes/Rack/MockRequest.html">Rack::MockRequest</A>
helps testing your Rack application without
actually using HTTP.
<PRE>
    Rack::MockRequest.new(Rsack::Server.new)
</PRE>
After performing a request on a URL <code>response = server.get('/')</code>
with <code>get/post/put/patch/delete</code>, it
returns a 
<A NAME="tex2html1018"
  HREF="http://rack.rubyforge.org/doc/Rack/MockResponse.html">MockResponse</A>
with useful helper methods for effective
testing (Véase el código de MockResponse en Github en el fichero
<A NAME="tex2html1019"
  HREF="https://github.com/rack/rack/blob/master/lib/rack/mock.rb#L149-L189">lib/rack/mock.rb</A>).

<P>
Un objeto <A NAME="tex2html1020"
  HREF="http://rack.rubyforge.org/doc/Rack/MockResponse.html">MockResponse</A>
dispone de los métodos:
<PRE>
=~   []   match   new
</PRE>
y de los atributos:
<PRE>
body   [R]   Body
errors   [RW]    Errors
headers  [R]   Headers
original_headers   [R]   Headers
status   [R]   Status
</PRE>

<P>
Si se usan middleware adicionales es necesario especificarlo en <code>server</code>. Por ejemplo:
<PRE>
 Rack::MockRequest.new(Rack::Session::Cookie.new(RockPaperScissors::App.new, 
                                                 :secret =&gt;'cookie'))
</PRE>

<P>

<H4><A NAME="SECTION031272060000000000000">
spec/spec_helper.rb</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ cat spec/spec_helper.rb 
$:.unshift File.expand_path(File.dirname(__FILE__)+'../lib')
$:.unshift File.dirname(__FILE__)

#puts $:.inspect

require 'rspec'
require 'rack'

require 'rsack'
</PRE>

<P>

<H4><A NAME="SECTION031272070000000000000">
Rakefile</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ cat Rakefile 
desc "run rspec tests"
task :default do
  sh "rspec spec/rsack/server_spec.rb"
end
</PRE>

<P>

<H4><A NAME="SECTION031272080000000000000">
Gemfile</A>
</H4>
  

<PRE>
[~/rack/rack-rspec(master)]$ cat Gemfile
# A sample Gemfile
source "https://rubygems.org"

gem 'rack'

group :development, :test do
  gem 'rspec'
end
</PRE>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html10600"
  HREF="node421.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html10594"
  HREF="node418.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html10590"
  HREF="node419.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html10596"
  HREF="node849.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html10598"
  HREF="node852.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> <A NAME="tex2html29"
  HREF="http://tinyurl.com/lpp1415"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="LPP moodle"></A><A NAME="tex2html30"
  HREF="https://campusvirtual.ull.es/1415/course/view.php?id=5678"><IMG
  WIDTH="50" ALIGN="BOTTOM" BORDER="0"
 SRC="moodleLHPlogo.jpeg"
 ALT="SYTW moodle"></A><A NAME="tex2html31"
  HREF="perlexamples.pdf"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="gv.jpeg"
 ALT="pdf"></A><A NAME="tex2html32"
  HREF="https://dl.dropbox.com/u/14539152/LPP/LPPbook/index.html"><IMG
  WIDTH="60" ALIGN="BOTTOM" BORDER="0"
 SRC="lupa.gif"
 ALT="ruby gems"></A><A NAME="tex2html33"
  HREF="http://www.ruby-doc.org/"><IMG
  WIDTH="30" ALIGN="BOTTOM" BORDER="0"
 SRC="perlonion.jpeg"
 ALT="perldoc"></A><A NAME="tex2html34"
  HREF="http://www.github.com"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="google-code-project-hosting.jpeg"
 ALT="github"></A><A NAME="tex2html35"
  HREF="http://rubylearning.com/blog/"><IMG
  WIDTH="27" ALIGN="BOTTOM" BORDER="0"
 SRC="perl6.jpg"
 ALT="blogs"></A><A NAME="tex2html36"
  HREF="http://www.google.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ggoogle.gif"
 ALT="google"></A><A NAME="tex2html37"
  HREF="http://www.ull.es/view/centros/etsii/Inicio/es"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="etsii.png"
 ALT="etsii"></A><A NAME="tex2html38"
  HREF="http://www.ull.es/"><IMG
  WIDTH="35" ALIGN="BOTTOM" BORDER="0"
 SRC="ull.gif"
 ALT="ull"></A><A NAME="tex2html39"
  HREF="https://plus.google.com/u/0/communities/115470806071217401678"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-lpp-1314"></A><A NAME="tex2html40"
  HREF="https://plus.google.com/u/0/communities/109091480492072495700"><IMG
  WIDTH="32" ALIGN="BOTTOM" BORDER="0"
 SRC="logopcgull.gif"
 ALT="ull-etsii-grado-stw-1314"></A>
<BR>
<B> Siguiente:</B> <A NAME="tex2html10601"
  HREF="node421.html">Práctica: Añada Pruebas a</A>
<B> Subir:</B> <A NAME="tex2html10595"
  HREF="node418.html">Pruebas/Testing</A>
<B> Anterior:</B> <A NAME="tex2html10591"
  HREF="node419.html">Pruebas Unitarias</A>
 &nbsp; <B>  <A NAME="tex2html10597"
  HREF="node849.html">&#205;ndice General</A></B> 
 &nbsp; <B>  <A NAME="tex2html10599"
  HREF="node852.html">&#205;ndice de Materias</A></B> </DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Casiano Rodriguez León
2014-12-03
</ADDRESS>
</BODY>
</HTML>
